<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>製作手順 | Note</title>
    <meta name="description" content="TodoアプリをRailsで作る過程を綴っていきます.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    
    <link rel="preload" href="/note/assets/css/0.styles.f813b145.css" as="style"><link rel="preload" href="/note/assets/js/app.3893ca96.js" as="script"><link rel="preload" href="/note/assets/js/12.459b11f9.js" as="script"><link rel="prefetch" href="/note/assets/js/10.655b36e8.js"><link rel="prefetch" href="/note/assets/js/11.6848059e.js"><link rel="prefetch" href="/note/assets/js/13.41095857.js"><link rel="prefetch" href="/note/assets/js/14.2605e9a9.js"><link rel="prefetch" href="/note/assets/js/15.7e35c70e.js"><link rel="prefetch" href="/note/assets/js/16.3257a301.js"><link rel="prefetch" href="/note/assets/js/2.d4541363.js"><link rel="prefetch" href="/note/assets/js/3.c6af1a0c.js"><link rel="prefetch" href="/note/assets/js/4.e6b13665.js"><link rel="prefetch" href="/note/assets/js/5.d0adc4f8.js"><link rel="prefetch" href="/note/assets/js/6.25babd5c.js"><link rel="prefetch" href="/note/assets/js/7.a99008a3.js"><link rel="prefetch" href="/note/assets/js/8.567b60e3.js"><link rel="prefetch" href="/note/assets/js/9.4e119371.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.f813b145.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">Note</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/todo.html" class="nav-link">Todo</a></div><div class="nav-item"><a href="/note/chukapi_fun_art.html" class="nav-link">Chukapi-Fun-Art</a></div><div class="nav-item"><a href="/note/list.html" class="nav-link">Articles</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/todo.html" class="nav-link">Todo</a></div><div class="nav-item"><a href="/note/chukapi_fun_art.html" class="nav-link">Chukapi-Fun-Art</a></div><div class="nav-item"><a href="/note/list.html" class="nav-link">Articles</a></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content"><h1 id="製作手順"><a href="#製作手順" aria-hidden="true" class="header-anchor">#</a> 製作手順</h1> <h1 id="_12-26"><a href="#_12-26" aria-hidden="true" class="header-anchor">#</a> 12/26</h1> <ol><li>rootのToppageの作成</li></ol> <h2 id="homeアクションとaboutアクションを追加"><a href="#homeアクションとaboutアクションを追加" aria-hidden="true" class="header-anchor">#</a> homeアクションとaboutアクションを追加</h2> <p>$ rails generate controller StaticPages home about
($ rails generate controller {ControllerName} {action_name}+)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Running via Spring preloader <span class="token keyword">in</span> process 30664
      create  app/controllers/static_pages_controller.rb
       route  get <span class="token string">'static_pages/about'</span>
       route  get <span class="token string">'static_pages/home'</span>
      invoke  erb
      create    app/views/static_pages
      create    app/views/static_pages/home.html.erb
      create    app/views/static_pages/about.html.erb
      invoke  test_unit
      create    test/controllers/static_pages_controller_test.rb
      invoke  helper
      create    app/helpers/static_pages_helper.rb
      invoke    test_unit
      invoke  assets
      invoke    coffee
      create      app/assets/javascripts/static_pages.coffee
      invoke    scss
      create      app/assets/stylesheets/static_pages.scss
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>結果, <code>$rails s</code>すると, 以下のページにアクセス可能になる。</p> <ul><li><a href="http://192.168.33.10:3000/static_pages/home" target="_blank" rel="noopener noreferrer">http://192.168.33.10:3000/static_pages/home<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://192.168.33.10:3000/static_pages/about" target="_blank" rel="noopener noreferrer">http://192.168.33.10:3000/static_pages/about<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="内容の編集"><a href="#内容の編集" aria-hidden="true" class="header-anchor">#</a> 内容の編集</h2> <p>表示される内容はViewにあたるので, 以下のパスに存在している。</p> <ul><li>/app/views/static_pages/home</li> <li>/app/views/static_pages/about</li></ul> <h2 id="テストの作成"><a href="#テストの作成" aria-hidden="true" class="header-anchor">#</a> テストの作成</h2> <p>テストは<code>/test/controllers/</code>以下に存在する。</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token comment"># test/controllers/static_pages_controller_test.rb</span>
<span class="token operator">~</span>
test “should get home” <span class="token keyword">do</span>
  <span class="token comment"># homeページにGETリクエスト</span>
  get static_pages_home_url
  <span class="token comment"># レスポンスがGREENになるはず</span>
  assert_response <span class="token symbol">:success</span>
<span class="token keyword">end</span>
<span class="token operator">~</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>テスト駆動開発はテストから作る。</p> <ul><li><p>リクエストして, 正しくレスポンスされるかを確認する
{get/post} {page_url}
assert_response :success</p></li> <li><p>オブジェクトが存在するかを確認
assert_select “{object_name(e.g. title)}”, “{Screening text}”</p></li></ul> <h2 id="埋め込みruby"><a href="#埋め込みruby" aria-hidden="true" class="header-anchor">#</a> 埋め込みRuby</h2> <p>&lt;% … %&gt; := 中に書かれたコードを実行するだけ
&lt;%= … %&gt; := 中に蚊kれたコードの実行結果がそこに挿入される</p> <p><code>provide</code>メソッドを使用してタイトルをページごとに変更する。</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code>app<span class="token operator">/</span>view<span class="token operator">/</span>static_pages<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>html<span class="token punctuation">.</span>erb
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token function">provide</span><span class="token punctuation">(</span><span class="token symbol">:title</span><span class="token punctuation">,</span> “<span class="token constant">Help</span>”<span class="token punctuation">)</span> <span class="token string">%&gt;
~
&lt;%= yield(:title) %&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ページのレイアウトは<code>app/views/layouts/application.html.erb</code>以下に存在している。
これを用いることで, <code>provide</code>メソッドを各ファイルで定義し, <code>yield</code>メソッドを書く必要がなくなる。</p> <h2 id="html5のサポート"><a href="#html5のサポート" aria-hidden="true" class="header-anchor">#</a> html5のサポート</h2> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token punctuation">[</span><span class="token keyword">if</span> lt <span class="token constant">IE</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;//cdnjs.cloudflare.com/ajax/libs/html5shiv/r29/html5.min.js&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span>endif<span class="token punctuation">]</span><span class="token operator">--</span><span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="bootstrapの追加"><a href="#bootstrapの追加" aria-hidden="true" class="header-anchor">#</a> bootstrapの追加</h2> <p>app/assets/stylesheet/custom.scssに,
@import bootstrap
@import bootstrap-sprockets
を追加</p> <h2 id="bootstrapの効果"><a href="#bootstrapの効果" aria-hidden="true" class="header-anchor">#</a> bootstrapの効果</h2> <p>navbar navbar-fixed-top := nav要素を上に表示
navbar-inverse := 色反転</p> <p>nav navbar-nav navbar-right := navbar内のnav要素を右に表示</p> <p>jumbotran := 背景をそれっぽく覆う</p> <h2 id="renderメソッドによる分散コーディング"><a href="#renderメソッドによる分散コーディング" aria-hidden="true" class="header-anchor">#</a> renderメソッドによる分散コーディング</h2> <p>&lt;%= render ‘layouts/hoge’ %&gt;
と書くと,
app/views/layout/_hoge.html.erb
を参照する。</p> <h2 id="アセットパイプライン"><a href="#アセットパイプライン" aria-hidden="true" class="header-anchor">#</a> アセットパイプライン</h2> <ul><li>app/assets := 現在のアプリケーション固有のアセット</li> <li>lib/assets := 開発チームによって作成されたライブラリ用のアセット</li> <li>vendor/assets := サードパーティのアセット</li></ul> <h2 id="フルプロセッサエンジン"><a href="#フルプロセッサエンジン" aria-hidden="true" class="header-anchor">#</a> フルプロセッサエンジン</h2> <p>chain可能で, 順番に参照して結合する。
末尾から実行される。
e.g.) hoge.js.coffee.erbだと, erb→coffeeScriptの順番</p> <h2 id="リンクのテスト-統合テスト"><a href="#リンクのテスト-統合テスト" aria-hidden="true" class="header-anchor">#</a> リンクのテスト(統合テスト)</h2> <p>$ rails generate integration_test {test_name}
test/integration/{test_name}_test.rbが作成される</p> <h1 id="_12-27"><a href="#_12-27" aria-hidden="true" class="header-anchor">#</a> 12/27</h1> <h1 id="usersモデルの作成"><a href="#usersモデルの作成" aria-hidden="true" class="header-anchor">#</a> Usersモデルの作成</h1> <p>まずはコントローラを作成</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ rails g controller Users new
<span class="token comment"># Usersコントローラにnewアクションを与える</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>次にモデルを作成
$ rails g model User name: string email string</p> <h2 id="モデルのバリデーション"><a href="#モデルのバリデーション" aria-hidden="true" class="header-anchor">#</a> モデルのバリデーション</h2> <p>app/models/user.rb以下に記入
validate {要素名}, オプション</p> <p>presence := 存在しているか
length := 文字列長(maximum, minimum, etc…)
uniqueness := 一意性があるか{ case_sensitive: false }で大文字小文字を区別しない
format: {with: } := 正規表現
/ := 正規表現の開始と終端
\A := 文字列の先頭
[\w+-.]+ := 英数字, _, +, -, .のいずれかを少なくとも1回繰り返す
@ := アットマーク
[a-z\d-.]+ := 英小文字, 数字, -, . のいずれか1つを少なくとも1文字以上繰り返す
. := ドット
[a-z]+ := 英小文字を少なくとも1回以上繰り返す
\z := 文字列の末尾
i := 大文字小文字を無視するオプション</p> <h2 id="dbのmigrate"><a href="#dbのmigrate" aria-hidden="true" class="header-anchor">#</a> dbのmigrate</h2> <p>ファイル直接書き換えの場合は,
$ rails db:migrate:reset</p> <h1 id="usersリソース"><a href="#usersリソース" aria-hidden="true" class="header-anchor">#</a> Usersリソース</h1> <p>config/routes.rbに
resources :users
を追加。</p> <p>すると, index, show, new, create, edit, update, destroyが使用可能になる。
アクションの定義は, app/controllers/users_controller.rbで行う。
def {action_name}
…
end
で追加できる。</p> <p>debuggerを追加するとbybugが使用可能になる。</p> <h2 id="signup"><a href="#signup" aria-hidden="true" class="header-anchor">#</a> signup</h2> <p>app/views/users/new.html.erbに追加。
明日はSignupのテストから。</p> <p>テスト終わり
assert_template
assert_select := 以降のテキストが存在しているか
content_tag := 以降の要素をタグとしてhtmlを作成
assert_no_difference := その中の行為で要素の変更がないことをテストする</p> <h1 id="sessions-login-logout"><a href="#sessions-login-logout" aria-hidden="true" class="header-anchor">#</a> sessions(login, logout)</h1> <h2 id="sessionsコントローラを生成-newアクションを追加"><a href="#sessionsコントローラを生成-newアクションを追加" aria-hidden="true" class="header-anchor">#</a> sessionsコントローラを生成(newアクションを追加)</h2> <p>$ rails g controller Sessions new</p> <h2 id="ルートを追加"><a href="#ルートを追加" aria-hidden="true" class="header-anchor">#</a> ルートを追加</h2> <p>get    '/login',   to: 'sessions#new'
post   '/login',   to: 'sessions#create'
delete '/logout',  to: 'sessions#destroy'</p> <h2 id="ルートを確認する"><a href="#ルートを確認する" aria-hidden="true" class="header-anchor">#</a> ルートを確認する</h2> <p>$ rails routes</p> <h2 id="flashメッセージで報告"><a href="#flashメッセージで報告" aria-hidden="true" class="header-anchor">#</a> flashメッセージで報告</h2> <p>def createの部分にflash.now[:danger] = ‘Invalid’を追加すると良い</p> <h2 id="トグルメニューの追加"><a href="#トグルメニューの追加" aria-hidden="true" class="header-anchor">#</a> トグルメニューの追加</h2> <p>class=“dropdown-toggle”を追加すればおk</p> <h2 id="ログアウト"><a href="#ログアウト" aria-hidden="true" class="header-anchor">#</a> ログアウト</h2> <p>helperに追加
session.delete(:user_id)
@current_user = nil
でおk。セッションを切っても@curernt_userはそのままなので, nilで上書きする</p> <p>その後, controllerに追加
controllerに全部書いてもいいが, 中身が大きくなりすぎるので, helperを用いて分割する。</p> <h1 id="todo"><a href="#todo" aria-hidden="true" class="header-anchor">#</a> todo</h1> <p>rails g model Task title:string
rails g controller Tasks
ルーティングの追加</p> <p>他のアクションの追加
new, create
viewの追加
edit, update</p> <p>controllerで宣言したresourceはviewでも利用可能</p> <h1 id="_1-27"><a href="#_1-27" aria-hidden="true" class="header-anchor">#</a> 1/27</h1> <h2 id="controller間のインスタンス参照"><a href="#controller間のインスタンス参照" aria-hidden="true" class="header-anchor">#</a> Controller間のインスタンス参照</h2> <p>他のコントローラのインスタンスは参照できないので, そのコントローラで他のコントローラを呼び出せばよい.<br>
以下のような感じ.</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token operator">/</span><span class="token operator">/</span> app<span class="token operator">/</span>controllers<span class="token operator">/</span>static_pages_controller<span class="token punctuation">.</span>rb
<span class="token keyword">class</span> <span class="token class-name">StaticPagesController</span> <span class="token operator">&lt;</span> <span class="token constant">ApplicationController</span>
  <span class="token keyword">def</span> home
    <span class="token variable">@user</span> <span class="token operator">=</span> current_user <span class="token keyword">if</span> logged_in<span class="token operator">?</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token operator">/</span><span class="token operator">/</span> app<span class="token operator">/</span>controllers<span class="token operator">/</span>helpers<span class="token operator">/</span>sessions_helper<span class="token punctuation">.</span>rb
<span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span>
<span class="token keyword">def</span> current_user
  <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span>
    <span class="token variable">@current_user</span> <span class="token operator">||</span><span class="token operator">=</span> <span class="token constant">User</span><span class="token punctuation">.</span><span class="token function">find_by</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> session<span class="token punctuation">[</span><span class="token symbol">:user_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
<span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="twitter認証"><a href="#twitter認証" aria-hidden="true" class="header-anchor">#</a> Twitter認証</h2> <p><a href="https://github.com/AGWA/git-crypt" target="_blank" rel="noopener noreferrer"><code>git-crypt</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>を使うと良いらしい?</p> <h2 id="api管理のためのgit-crypt"><a href="#api管理のためのgit-crypt" aria-hidden="true" class="header-anchor">#</a> API管理のためのgit-crypt</h2> <p><a href="https://github.com/AGWA/git-crypt" target="_blank" rel="noopener noreferrer">git-crypt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="installation"><a href="#installation" aria-hidden="true" class="header-anchor">#</a> Installation</h3> <p><a href="https://github.com/AGWA/git-crypt/blob/master/INSTALL.md" target="_blank" rel="noopener noreferrer">Install.md<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>に書いてある.</p> <h4 id="_1-clone"><a href="#_1-clone" aria-hidden="true" class="header-anchor">#</a> 1. clone</h4> <p>リポジトリをクローン.<br> <code>$ git clone https://github.com/AGWA/git-crypt.git</code></p> <h4 id="_2-makeしてmake-install"><a href="#_2-makeしてmake-install" aria-hidden="true" class="header-anchor">#</a> 2. <code>make</code>して<code>make install</code></h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ make
$ make install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_3-gpgで作るための-confファイルを作成"><a href="#_3-gpgで作るための-confファイルを作成" aria-hidden="true" class="header-anchor">#</a> 3. <code>gpg</code>で作るための<code>*.conf</code>ファイルを作成</h4> <p>いちいち入力してるとミスがあったときに困るので, <code>.conf</code>ファイルで設定します.<br>
(今回はkey-gen.confとします).<br>
ファイルの内容は以下の通り.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// key-gen.conf
Key-Type: RSA
Key-Length: 4096

SubKey-Type: RSA
SubKey-Length: 4096

Expire-Date: 2y           // 期間(お好みでok)

Name-Real: {real-name}    // 名前をここに入力
Name-Email: {email}       // emailアドレスをここに入力

passphrase: {pass-phrase} // pass-phraseをここに入力

%commit                   
%echo Successfully done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_4-rng-toolsのインストール"><a href="#_4-rng-toolsのインストール" aria-hidden="true" class="header-anchor">#</a> 4. rng-toolsのインストール</h4> <p>このまま<code>$ gpg --gen-key --batch key-gen.conf</code>をしても良いが, かなり時間がかかるので<code>rng-tools</code>パッケージを使う。</p> <blockquote><p>rngd は /dev/hwrng から乱数を得て, カーネルのエントロピープールに乱数を提供します. rngd はあくまでカーネルのエントロピープールに乱数を提供するのみで, ハードウェア乱数生成器のデータを直接 /dev/random 等から出力するのでありません. また rngd は入力されたデータが本当にランダムかどうか, FIPS 140-2 (2002-10-10) テストを行ってくれます.</p></blockquote> <blockquote><p>ハードウェア乱数生成器を利用することで /dev/random からより高速に乱数を生成することができます. ハードウェア乱数生成器を利用しない場合と利用する場合の生成速度の違いは以下のようになります.
(引用:<a href="https://blog.ymyzk.com/2015/05/raspberry-pi-hardware-random-number-generator/" target="_blank" rel="noopener noreferrer">Raspberry Pi のハードウェア乱数生成器を利用する<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</p></blockquote> <p>私はCentOS7を利用しているので, 以下のコマンドを叩きました.<br>
(環境に応じてコマンドを変更してください)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo yum install rng-tools
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_5-gpgによる鍵の生成"><a href="#_5-gpgによる鍵の生成" aria-hidden="true" class="header-anchor">#</a> 5. gpgによる鍵の生成</h3> <p>以下のコマンドを実行して鍵を生成します.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ gpg --gen-key --batch ./key-gen.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>その後, 別のterminalを開き, 以下のコマンドを実行します.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo rngd -r /dev/urandom
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>すると, 最初の<code>gpg</code>コマンドの方で, 以下のように出力されるはずです.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>gpg --gen-key --batch ./key-gen.conf
gpg: 鍵*を絶対的に信用するよう記録しました
gpg: Successfully done
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_6-git-cryptの設定"><a href="#_6-git-cryptの設定" aria-hidden="true" class="header-anchor">#</a> 6. git-cryptの設定</h3> <p>設定は, <code>.gitattributes</code>に以下のように書き込みます.<br>
ここで, {file-name}の部分には暗号化したいファイル名を入れます.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// .gitattributes
{file-name} filter=git-crypt diff=git-crypt

e.g.)  
API-KEY.xml filter=git-crypt diff=git-crypt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>その後, 以下のコマンドでGPGで生成した鍵を特定できる文字列を入れます.<br>
私はgpgで鍵を生成したときの<code>email</code>を入れました.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ git-crypt add-gpg-user {email}

e.g.) 
$ git-crypt add-gpg-user hoge@fuga.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_7-git-add"><a href="#_7-git-add" aria-hidden="true" class="header-anchor">#</a> 7. git add</h4> <p>あとは, <code>.gitattributes</code>で設定したファイルをステージング(<code>$ git add</code>)します.<br>
暗号化されているファイルは<br> <code>$ git-crypt status -e</code><br>
で確認できます.<br>
もし, 暗号化されていないのにステージングされている場合は,
<code>$ git-crypt status -f</code><br>
で暗号化対象にされるので, OKです.</p> <p>Twitter APPの認証が必要らしいので, 少し待ちます.<br> <a href="https://reasonable-code.com/rails-twitter-auth/" target="_blank" rel="noopener noreferrer">Ruby on RailsでTwitter認証機能を実装してみる<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h1 id="postの設定"><a href="#postの設定" aria-hidden="true" class="header-anchor">#</a> Postの設定</h1> <p><code>app/controllers/shared/_task_form.html.erb</code>が正しく描画されないことが多々あった.</p> <p>その原因は, <code>form_for</code>の引数を<code>@user.tasks</code>というリレーションにしていたからだった.</p> <p>そのため, 新しく<code>@tasks</code>インスタンスを宣言し,<br> <code>static_pages_controller.rb</code>の<code>home</code>アクションで,</p> <div class="language-ruby line-numbers-mode"><pre class="language-ruby"><code><span class="token keyword">def</span> home
  <span class="token operator">~</span><span class="token operator">~</span>
  <span class="token variable">@tasks</span> <span class="token operator">=</span> current_user<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span>build <span class="token keyword">if</span> logged_in<span class="token operator">?</span>
<span class="token keyword">end</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>を追記した.</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/note/assets/js/app.3893ca96.js" defer></script><script src="/note/assets/js/12.459b11f9.js" defer></script>
  </body>
</html>
