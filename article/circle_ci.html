<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CircleCIを用いたVuePressの自動ビルド+デプロイ | Note</title>
    <meta name="description" content="VuePressの自動ビルド+デプロイ">
    
    
    <link rel="preload" href="/note/assets/css/0.styles.ab390519.css" as="style"><link rel="preload" href="/note/assets/js/app.69b7a291.js" as="script"><link rel="preload" href="/note/assets/js/5.4b6140b2.js" as="script"><link rel="preload" href="/note/assets/js/2.c2c74dfd.js" as="script"><link rel="preload" href="/note/assets/js/41.22373bcb.js" as="script"><link rel="prefetch" href="/note/assets/js/10.8a902e14.js"><link rel="prefetch" href="/note/assets/js/11.f5265aaa.js"><link rel="prefetch" href="/note/assets/js/12.310ecab0.js"><link rel="prefetch" href="/note/assets/js/13.aa06932f.js"><link rel="prefetch" href="/note/assets/js/14.26a5e8cc.js"><link rel="prefetch" href="/note/assets/js/15.5ee65e59.js"><link rel="prefetch" href="/note/assets/js/16.36e05484.js"><link rel="prefetch" href="/note/assets/js/17.b7b0fb4f.js"><link rel="prefetch" href="/note/assets/js/18.983b9e61.js"><link rel="prefetch" href="/note/assets/js/19.72a28a97.js"><link rel="prefetch" href="/note/assets/js/20.8a8aa887.js"><link rel="prefetch" href="/note/assets/js/21.ec0e344a.js"><link rel="prefetch" href="/note/assets/js/22.bd7f935d.js"><link rel="prefetch" href="/note/assets/js/23.73dc1b1b.js"><link rel="prefetch" href="/note/assets/js/24.ebfdb62b.js"><link rel="prefetch" href="/note/assets/js/25.273128bd.js"><link rel="prefetch" href="/note/assets/js/26.e7f259ff.js"><link rel="prefetch" href="/note/assets/js/27.f2edf00b.js"><link rel="prefetch" href="/note/assets/js/28.a7e1b037.js"><link rel="prefetch" href="/note/assets/js/29.9e8c9032.js"><link rel="prefetch" href="/note/assets/js/3.faf42d1d.js"><link rel="prefetch" href="/note/assets/js/30.852715c4.js"><link rel="prefetch" href="/note/assets/js/31.39d83b4d.js"><link rel="prefetch" href="/note/assets/js/32.69d0f1b1.js"><link rel="prefetch" href="/note/assets/js/33.eb7ec929.js"><link rel="prefetch" href="/note/assets/js/34.5cb6cbd0.js"><link rel="prefetch" href="/note/assets/js/35.63bddfca.js"><link rel="prefetch" href="/note/assets/js/36.a4b69c6b.js"><link rel="prefetch" href="/note/assets/js/37.13f07d7b.js"><link rel="prefetch" href="/note/assets/js/38.538d59d3.js"><link rel="prefetch" href="/note/assets/js/39.6aef6f5b.js"><link rel="prefetch" href="/note/assets/js/4.7a95267e.js"><link rel="prefetch" href="/note/assets/js/40.3ca9e7c5.js"><link rel="prefetch" href="/note/assets/js/42.6b3b2783.js"><link rel="prefetch" href="/note/assets/js/43.947c4ebe.js"><link rel="prefetch" href="/note/assets/js/44.3fb3b4b8.js"><link rel="prefetch" href="/note/assets/js/45.58bb9459.js"><link rel="prefetch" href="/note/assets/js/46.36925e41.js"><link rel="prefetch" href="/note/assets/js/47.a5926a9f.js"><link rel="prefetch" href="/note/assets/js/48.afc8a790.js"><link rel="prefetch" href="/note/assets/js/49.81147a5a.js"><link rel="prefetch" href="/note/assets/js/50.72a9badd.js"><link rel="prefetch" href="/note/assets/js/51.57255456.js"><link rel="prefetch" href="/note/assets/js/52.7f428561.js"><link rel="prefetch" href="/note/assets/js/53.ef1c2477.js"><link rel="prefetch" href="/note/assets/js/54.056f1c5d.js"><link rel="prefetch" href="/note/assets/js/55.83ed9cda.js"><link rel="prefetch" href="/note/assets/js/56.d56e3069.js"><link rel="prefetch" href="/note/assets/js/57.911fd5bd.js"><link rel="prefetch" href="/note/assets/js/58.2ec1d0fb.js"><link rel="prefetch" href="/note/assets/js/59.42ec66f7.js"><link rel="prefetch" href="/note/assets/js/6.be8af10f.js"><link rel="prefetch" href="/note/assets/js/60.99637a94.js"><link rel="prefetch" href="/note/assets/js/61.5e9d6df8.js"><link rel="prefetch" href="/note/assets/js/62.3790d4c8.js"><link rel="prefetch" href="/note/assets/js/63.e2e3e897.js"><link rel="prefetch" href="/note/assets/js/64.025c43ed.js"><link rel="prefetch" href="/note/assets/js/65.dfe2ad58.js"><link rel="prefetch" href="/note/assets/js/66.7b4dfccc.js"><link rel="prefetch" href="/note/assets/js/67.56a34351.js"><link rel="prefetch" href="/note/assets/js/68.bd28e0d4.js"><link rel="prefetch" href="/note/assets/js/69.fcad0bfc.js"><link rel="prefetch" href="/note/assets/js/7.f74e4ac5.js"><link rel="prefetch" href="/note/assets/js/70.de53e067.js"><link rel="prefetch" href="/note/assets/js/71.59136d52.js"><link rel="prefetch" href="/note/assets/js/72.562d536e.js"><link rel="prefetch" href="/note/assets/js/73.84f3e593.js"><link rel="prefetch" href="/note/assets/js/74.f139287e.js"><link rel="prefetch" href="/note/assets/js/75.f683c45d.js"><link rel="prefetch" href="/note/assets/js/76.f16abc01.js"><link rel="prefetch" href="/note/assets/js/77.b5db38bc.js"><link rel="prefetch" href="/note/assets/js/78.2cd8b11d.js"><link rel="prefetch" href="/note/assets/js/79.deb7849b.js"><link rel="prefetch" href="/note/assets/js/8.3c008a46.js"><link rel="prefetch" href="/note/assets/js/9.aa64878f.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.ab390519.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/about.html" class="nav-link">About</a></div><div class="nav-item"><a href="/note/list.html" class="nav-link">Articles</a></div><div class="nav-item"><a href="/note/chukapi_fun_art.html" class="nav-link">Chukapi-Fun-Art</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/about.html" class="nav-link">About</a></div><div class="nav-item"><a href="/note/list.html" class="nav-link">Articles</a></div><div class="nav-item"><a href="/note/chukapi_fun_art.html" class="nav-link">Chukapi-Fun-Art</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>CircleCIを用いたVuePressの自動ビルド+デプロイ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/article/circle_ci.html#初期設定" class="sidebar-link">初期設定</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#_1-登録" class="sidebar-link">1. 登録</a></li><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#_2-ssh-keyの設定" class="sidebar-link">2.ssh-keyの設定</a></li><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#_3-circleci-cliツールのインストール" class="sidebar-link">3.CircleCI CLIツールのインストール</a></li></ul></li><li><a href="/note/article/circle_ci.html#circleci-config-ymlファイルの作成" class="sidebar-link">.circleci/config.ymlファイルの作成</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/article/circle_ci.html#作成したファイルのvalidation" class="sidebar-link">作成したファイルのvalidation</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/article/circle_ci.html#_0-nodeのパッケージインストール" class="sidebar-link">0. nodeのパッケージインストール</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/article/circle_ci.html#_1-yarn-src-buildの実行" class="sidebar-link">1. $ yarn src:buildの実行</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/article/circle_ci.html#_2-gh-pagesブランチに配置" class="sidebar-link">2. gh-pagesブランチに配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#スクリプトの作成" class="sidebar-link">スクリプトの作成</a></li><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#スクリプトを実行するコマンドの追記" class="sidebar-link">スクリプトを実行するコマンドの追記</a></li><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#circleci-config-ymlへの追記" class="sidebar-link">.circleci/config.ymlへの追記</a></li><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#書いた-circleci-config-ymlのvalidate" class="sidebar-link">書いた.circleci/config.ymlのvalidate</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="circleciを用いたvuepressの自動ビルド-デプロイ"><a href="#circleciを用いたvuepressの自動ビルド-デプロイ" class="header-anchor">#</a> CircleCIを用いたVuePressの自動ビルド+デプロイ</h1> <ul><li>タイトルのとおりです</li></ul> <h1 id="はじめに"><a href="#はじめに" class="header-anchor">#</a> はじめに</h1> <ul><li><p>VuePressは毎回buildする必要があるので面倒</p></li> <li><p>誰かがCIを使って自動デプロイとか言ってたな</p></li> <li><p>やってみるか</p></li> <li><p>や　り　ま　し　た</p></li></ul> <h1 id="circleciのセッティング"><a href="#circleciのセッティング" class="header-anchor">#</a> CircleCIのセッティング</h1> <ul><li>インストール等のセッティングを行います</li> <li>本題を見たい方は, 本題まで飛んでください</li></ul> <h2 id="初期設定"><a href="#初期設定" class="header-anchor">#</a> 初期設定</h2> <ul><li>大抵はつぎの公式ページに書かれています</li> <li>公式がちゃんとしているので書くことはあまりないですが, 流れだけざっとさらっていきます</li> <li>部分的に翻訳されているようです
<ul><li><a href="https://circleci.com/docs/ja/2.0/" target="_blank" rel="noopener noreferrer">Welcome to CircleCI Documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h3 id="_1-登録"><a href="#_1-登録" class="header-anchor">#</a> 1. 登録</h3> <ul><li>つぎの公式記事の通りに進めれば問題ないはずです
<ul><li><a href="https://circleci.com/docs/ja/2.0/first-steps/#section=getting-started" target="_blank" rel="noopener noreferrer">CircleCIを始める<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h3 id="_2-ssh-keyの設定"><a href="#_2-ssh-keyの設定" class="header-anchor">#</a> 2.ssh-keyの設定</h3> <ul><li>つぎの記事の通りに進めれば問題ないはずです
<ul><li><a href="https://qiita.com/boushi-bird@github/items/6b6eb1d1ed6f6d3341e4" target="_blank" rel="noopener noreferrer">Circle CI で Github に write access 可能な Deploy key を設定する<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://circleci.com/docs/ja/2.0/add-ssh-key/" target="_blank" rel="noopener noreferrer">CircleCI に SSH 鍵を登録する<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <div class="custom-block danger"><p class="custom-block-title">注意</p> <ul><li><strong>パスフレーズ付きのrsa鍵だとCircleCI側から認められないので注意してください</strong> <ul><li>これに騙されました</li></ul></li></ul></div> <h3 id="_3-circleci-cliツールのインストール"><a href="#_3-circleci-cliツールのインストール" class="header-anchor">#</a> 3.CircleCI CLIツールのインストール</h3> <ul><li><p>つぎの公式記事の通りに進めれば問題ないはずです</p> <ul><li><a href="https://circleci.com/docs/ja/2.0/local-cli/#installation" target="_blank" rel="noopener noreferrer">Installation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><p>CircleCI CLIツールでは, つぎのようなことができます</p> <ul><li>CI config(.circleci/config.yml)のデバッグとvalidation</li> <li>ローカルでのジョブ実行</li> <li>CircleCIのAPI利用</li> <li>CircleCI Orbs関連</li></ul></li> <li><p>インストールするコマンドだけ残しておきます</p></li> <li><p>MacとLinuxでは次のコマンドでインストールできるようです</p></li> <li><p>念の為アップデートまで含めたコマンドを書いておきます</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># install</span>
$ <span class="token function">curl</span> -fLSs https://circle.ci/cli <span class="token operator">|</span> <span class="token function">bash</span> 
<span class="token comment"># update</span>
$ circleci update
$ circleci switch
</code></pre></div><ul><li>インストールしている際に, <code>permission denied</code>が発生することがあるようです</li> <li>その時はつぎのようにコマンドを変更して対処してください</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code></code></pre></div><h2 id="circleci-config-ymlファイルの作成"><a href="#circleci-config-ymlファイルの作成" class="header-anchor">#</a> .circleci/config.ymlファイルの作成</h2> <ul><li>CircleCIの動作を定義するymlファイルを作成します</li> <li>記法についてはつぎの記事の通りに書けば問題ないはずです
<ul><li><a href="https://circleci.com/docs/2.0/configuration-reference/" target="_blank" rel="noopener noreferrer">Configuring CircleCI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <div class="custom-block danger"><p class="custom-block-title">注意</p> <ul><li><strong>インデントでerrorになることが多いです</strong></li> <li>注意しましょう
<ul><li>これで小一時間溶かしました</li></ul></li></ul></div> <ul><li>雛形は, 先ほどの記事の下の方にあります
<ul><li><a href="https://circleci.com/docs/2.0/configuration-reference/#full-example" target="_blank" rel="noopener noreferrer">Full Example<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h2 id="作成したファイルのvalidation"><a href="#作成したファイルのvalidation" class="header-anchor">#</a> 作成したファイルのvalidation</h2> <ul><li><p>つぎの公式記事の通りに進めれば問題ないはずです</p> <ul><li><a href="https://circleci.com/docs/2.0/local-cli/#validate-a-circleci-config" target="_blank" rel="noopener noreferrer">Validate A CircleCI Config<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><p>次のコマンドでvalidationができます</p> <ul><li>ただし, config.ymlは<code>.circleci/config.yml</code>に配置しましょう</li></ul></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ circleci config validate
<span class="token comment"># Config file at .circleci/config.yml is valid</span>
</code></pre></div><h1 id="本題"><a href="#本題" class="header-anchor">#</a> 本題</h1> <ul><li><p>タイトルで触れている自動ビルド + デプロイの部分に入っていきます</p></li> <li><p>全体の流れはつぎのとおりです</p></li> <li><p>四角で囲まれた部分をCircleCIを用いて構築していきます</p></li> <li><p>CircleCIにやってもらいたいことは, つぎの2つです</p> <ul><li><code>$ yarn src:build</code>の実行</li> <li>実行後にできた<code>./docs</code>以下のファイルを<code>gh-pages</code>ブランチに配置</li></ul></li> <li><p>しかし, いずれもnodeのパッケージをインストールしておく必要があります</p></li> <li><p>その処理を書いてから, 先ほどの2つの処理を加えていきます</p></li></ul> <h2 id="_0-nodeのパッケージインストール"><a href="#_0-nodeのパッケージインストール" class="header-anchor">#</a> 0. nodeのパッケージインストール</h2> <ul><li>nodeのパッケージをインストールするためには, つぎのように書きます</li> <li><code>restore_cache</code>と<code>save_cache</code>でnode_moduleのキャッシュを残しておくものです</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code>// .circleci/config.yml
+ version<span class="token punctuation">:</span> <span class="token number">2</span>
+ jobs<span class="token punctuation">:</span>
+   build<span class="token punctuation">:</span>
+     docker<span class="token punctuation">:</span>
+       <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">8.12</span>
+     working_directory<span class="token punctuation">:</span> ~/task4233/note
+     steps<span class="token punctuation">:</span>
+       <span class="token punctuation">-</span> checkout
+       <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span>
+           key<span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
+       <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
+           name<span class="token punctuation">:</span> Install dependencies
+           command<span class="token punctuation">:</span> yarn
+       <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>
+           key<span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
+           paths<span class="token punctuation">:</span>
+             <span class="token punctuation">-</span> ./node_modules
+
+ workflows<span class="token punctuation">:</span>
+   version<span class="token punctuation">:</span> <span class="token number">2</span>
+   build<span class="token punctuation">-</span><span class="token key atrule">deploy</span><span class="token punctuation">:</span>
+     jobs<span class="token punctuation">:</span>
+       <span class="token punctuation">-</span> build
</code></pre></div><h2 id="_1-yarn-src-buildの実行"><a href="#_1-yarn-src-buildの実行" class="header-anchor">#</a> 1. <code>$ yarn src:build</code>の実行</h2> <ul><li>これは簡単です</li> <li>つぎのように, <code>.circleci/config.yml</code>に追記します</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code>// .circleci/config.yml
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">8.12</span>
    <span class="token key atrule">working_directory</span><span class="token punctuation">:</span> ~/task4233/note
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> checkout
      <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
          <span class="token key atrule">command</span><span class="token punctuation">:</span> yarn
      <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">paths</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ./node_modules
 +     <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
 +         name<span class="token punctuation">:</span> Build
 +         command<span class="token punctuation">:</span> yarn src<span class="token punctuation">:</span>build

<span class="token key atrule">workflows</span><span class="token punctuation">:</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">build-deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">jobs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> build
</code></pre></div><h2 id="_2-gh-pagesブランチに配置"><a href="#_2-gh-pagesブランチに配置" class="header-anchor">#</a> 2. <code>gh-pages</code>ブランチに配置</h2> <ul><li>そのようなスクリプトは存在していないので, スクリプトを作成して<code>.circleci/config.yml</code>に追記します</li></ul> <h3 id="スクリプトの作成"><a href="#スクリプトの作成" class="header-anchor">#</a> スクリプトの作成</h3> <ul><li><code>gh-pages</code>ブランチに<code>./docs</code>以下のファイルを配置するために, nodejsの<code>gh-pages</code>パッケージを利用します</li> <li>つぎのように新たに<code>deploy.js</code>を書きます</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// deploy.js</span>
<span class="token operator">+</span> <span class="token keyword">var</span> ghpages <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gh-pages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span> ghpages<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;./docs&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>     user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         name<span class="token punctuation">:</span> <span class="token string">&quot;{YOUR_NAME}&quot;</span><span class="token punctuation">,</span>
<span class="token operator">+</span>         email<span class="token punctuation">:</span> <span class="token string">&quot;{YOUR_EMAIL}&quot;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">+</span>     message<span class="token punctuation">:</span> <span class="token string">&quot;Auto build and deploy [ci skip]&quot;</span>
<span class="token operator">+</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>         process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Successfully Delployed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span>
<span class="token operator">+</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>6,7行目は自身のものに変更してください</li> <li>9行目でわざわざmessageを記載しているのは, コミットメッセージに<code>[ci skip]</code>を付与することで<code>gh-pages</code>ブランチでCircleCIを動作させないためです
<ul><li><code>gh-pages</code>ブランチは公開用ブランチなので, <code>gh-pages</code>ブランチではCircleCIを動作させません</li></ul></li></ul> <h3 id="スクリプトを実行するコマンドの追記"><a href="#スクリプトを実行するコマンドの追記" class="header-anchor">#</a> スクリプトを実行するコマンドの追記</h3> <ul><li>このjsファイルを実行させるためのコマンドを<code>package.json</code>に追記します</li> <li>他の部分は私の設定なので, 自身の<code>package.json</code>に7行目の内容のみ追記してください</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;pg&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;main&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>       <span class="token string">&quot;deploy&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;node ./deploy.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;src:dev&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;vuepress dev src --port 3030&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;src:build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;rm -rf ./docs &amp;&amp; vuepress build src&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;repository&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;git&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;url&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;git+https://github.com/task4233/note.git&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;author&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;task4233&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;license&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;devDependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;markdown-it&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^8.4.2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;markdown-it-katex&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.0.3&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;markdown-it-task-lists&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.1.1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;vuepress&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^0.14.8&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gh-pages&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.0.1&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="circleci-config-ymlへの追記"><a href="#circleci-config-ymlへの追記" class="header-anchor">#</a> .circleci/config.ymlへの追記</h3> <ul><li>コマンドが完成したので, <code>.circleci/config.yml</code>に追記します</li> <li>つぎのように追記します</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">8.12</span>
    <span class="token key atrule">working_directory</span><span class="token punctuation">:</span> ~/task4233/note
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> checkout
      <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
          <span class="token key atrule">command</span><span class="token punctuation">:</span> yarn
      <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">paths</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ./node_modules
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Build
          <span class="token key atrule">command</span><span class="token punctuation">:</span> yarn src<span class="token punctuation">:</span>build
 +    <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
 +        name<span class="token punctuation">:</span> Deploy
 +        command<span class="token punctuation">:</span> yarn deploy

<span class="token key atrule">workflows</span><span class="token punctuation">:</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">build-deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">jobs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> build
</code></pre></div><h3 id="書いた-circleci-config-ymlのvalidate"><a href="#書いた-circleci-config-ymlのvalidate" class="header-anchor">#</a> 書いた.circleci/config.ymlのvalidate</h3> <ul><li>githubにpushしてから<code>config.yml</code>のせいでエラーがでると悲しくなるので, ローカルでvalidateします</li> <li>つぎのコマンドでvalidateできます</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ circleci config validate -c <span class="token punctuation">{</span>config.ymlまでのファイルパス<span class="token punctuation">}</span>
<span class="token comment"># circleci config validate -c ./.circleci/config.yml</span>
<span class="token comment"># Config file at ./.circleci/config.yml is valid.</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2019-3-23 11:13:12</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.69b7a291.js" defer></script><script src="/note/assets/js/5.4b6140b2.js" defer></script><script src="/note/assets/js/2.c2c74dfd.js" defer></script><script src="/note/assets/js/41.22373bcb.js" defer></script>
  </body>
</html>
