<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CircleCIを用いたVuePressの自動ビルド+デプロイ</title>
    <meta name="description" content="VuePressの自動ビルド+デプロイ">
    
    
    <link rel="preload" href="/assets/css/0.styles.927c50e1.css" as="style"><link rel="preload" href="/assets/js/app.e447834c.js" as="script"><link rel="preload" href="/assets/js/4.ea1d030e.js" as="script"><link rel="preload" href="/assets/js/18.c76a41c9.js" as="script"><link rel="prefetch" href="/assets/js/10.5fb78c6b.js"><link rel="prefetch" href="/assets/js/11.00a32e57.js"><link rel="prefetch" href="/assets/js/12.9753e7a4.js"><link rel="prefetch" href="/assets/js/13.4f4cba50.js"><link rel="prefetch" href="/assets/js/14.487fd3e0.js"><link rel="prefetch" href="/assets/js/15.fff641af.js"><link rel="prefetch" href="/assets/js/16.e24f8c23.js"><link rel="prefetch" href="/assets/js/17.e5931d87.js"><link rel="prefetch" href="/assets/js/19.69fd1a13.js"><link rel="prefetch" href="/assets/js/2.e4b447ce.js"><link rel="prefetch" href="/assets/js/20.1d5aa23a.js"><link rel="prefetch" href="/assets/js/21.7456dddc.js"><link rel="prefetch" href="/assets/js/22.43561a19.js"><link rel="prefetch" href="/assets/js/23.f9ab2c6c.js"><link rel="prefetch" href="/assets/js/24.572a4c17.js"><link rel="prefetch" href="/assets/js/25.da0470d9.js"><link rel="prefetch" href="/assets/js/26.1498e92e.js"><link rel="prefetch" href="/assets/js/27.1b5e231b.js"><link rel="prefetch" href="/assets/js/28.7ff35c37.js"><link rel="prefetch" href="/assets/js/29.fc487f01.js"><link rel="prefetch" href="/assets/js/3.685664ec.js"><link rel="prefetch" href="/assets/js/30.3d0a5dee.js"><link rel="prefetch" href="/assets/js/31.6fb8f56c.js"><link rel="prefetch" href="/assets/js/32.eb72ad8c.js"><link rel="prefetch" href="/assets/js/33.02308810.js"><link rel="prefetch" href="/assets/js/34.6684b118.js"><link rel="prefetch" href="/assets/js/35.54494384.js"><link rel="prefetch" href="/assets/js/36.9c621ce9.js"><link rel="prefetch" href="/assets/js/37.540c8a48.js"><link rel="prefetch" href="/assets/js/38.03386e31.js"><link rel="prefetch" href="/assets/js/39.1242d758.js"><link rel="prefetch" href="/assets/js/40.480f85c3.js"><link rel="prefetch" href="/assets/js/41.4b5ba5a3.js"><link rel="prefetch" href="/assets/js/42.8cd7f453.js"><link rel="prefetch" href="/assets/js/43.71661e52.js"><link rel="prefetch" href="/assets/js/44.034fcd2c.js"><link rel="prefetch" href="/assets/js/45.d3084f6f.js"><link rel="prefetch" href="/assets/js/46.fdf5f3bf.js"><link rel="prefetch" href="/assets/js/47.83ae43c4.js"><link rel="prefetch" href="/assets/js/48.69175fae.js"><link rel="prefetch" href="/assets/js/49.b9434479.js"><link rel="prefetch" href="/assets/js/5.93dd8e5f.js"><link rel="prefetch" href="/assets/js/50.62e4ceac.js"><link rel="prefetch" href="/assets/js/51.b5080153.js"><link rel="prefetch" href="/assets/js/52.868f2885.js"><link rel="prefetch" href="/assets/js/53.3313359d.js"><link rel="prefetch" href="/assets/js/54.eac3ac31.js"><link rel="prefetch" href="/assets/js/55.f8f80c24.js"><link rel="prefetch" href="/assets/js/56.915b9bdc.js"><link rel="prefetch" href="/assets/js/6.3684d401.js"><link rel="prefetch" href="/assets/js/7.462e790c.js"><link rel="prefetch" href="/assets/js/8.7999708e.js"><link rel="prefetch" href="/assets/js/9.ff1fb5db.js">
    <link rel="stylesheet" href="/assets/css/0.styles.927c50e1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="content__default"><h1 id="circleciを用いたvuepressの自動ビルド-デプロイ"><a href="#circleciを用いたvuepressの自動ビルド-デプロイ" aria-hidden="true" class="header-anchor">#</a> CircleCIを用いたVuePressの自動ビルド+デプロイ</h1> <ul><li>タイトルのとおりです</li></ul> <h1 id="はじめに"><a href="#はじめに" aria-hidden="true" class="header-anchor">#</a> はじめに</h1> <ul><li><p>VuePressは毎回buildする必要があるので面倒</p></li> <li><p>誰かがCIを使って自動デプロイとか言ってたな</p></li> <li><p>やってみるか</p></li> <li><p>や　り　ま　し　た</p></li></ul> <h1 id="circleciのセッティング"><a href="#circleciのセッティング" aria-hidden="true" class="header-anchor">#</a> CircleCIのセッティング</h1> <ul><li>インストール等のセッティングを行います</li> <li>本題を見たい方は, 本題まで飛んでください</li></ul> <h2 id="初期設定"><a href="#初期設定" aria-hidden="true" class="header-anchor">#</a> 初期設定</h2> <ul><li>大抵はつぎの公式ページに書かれています</li> <li>公式がちゃんとしているので書くことはあまりないですが, 流れだけざっとさらっていきます</li> <li>部分的に翻訳されているようです
<ul><li><a href="https://circleci.com/docs/ja/2.0/" target="_blank" rel="noopener noreferrer">Welcome to CircleCI Documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h3 id="_1-登録"><a href="#_1-登録" aria-hidden="true" class="header-anchor">#</a> 1. 登録</h3> <ul><li>つぎの公式記事の通りに進めれば問題ないはずです
<ul><li><a href="https://circleci.com/docs/ja/2.0/first-steps/#section=getting-started" target="_blank" rel="noopener noreferrer">CircleCIを始める<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h3 id="_2-ssh-keyの設定"><a href="#_2-ssh-keyの設定" aria-hidden="true" class="header-anchor">#</a> 2.ssh-keyの設定</h3> <ul><li>つぎの記事の通りに進めれば問題ないはずです
<ul><li><a href="https://qiita.com/boushi-bird@github/items/6b6eb1d1ed6f6d3341e4" target="_blank" rel="noopener noreferrer">Circle CI で Github に write access 可能な Deploy key を設定する<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://circleci.com/docs/ja/2.0/add-ssh-key/" target="_blank" rel="noopener noreferrer">CircleCI に SSH 鍵を登録する<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <p>::: danger 注意</p> <ul><li><strong>パスフレーズ付きのrsa鍵だとCircleCI側から認められないので注意してください</strong> <ul><li>これに騙されました
:::</li></ul></li></ul> <h3 id="_3-circleci-cliツールのインストール"><a href="#_3-circleci-cliツールのインストール" aria-hidden="true" class="header-anchor">#</a> 3.CircleCI CLIツールのインストール</h3> <ul><li><p>つぎの公式記事の通りに進めれば問題ないはずです</p> <ul><li><a href="https://circleci.com/docs/ja/2.0/local-cli/#installation" target="_blank" rel="noopener noreferrer">Installation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><p>CircleCI CLIツールでは, つぎのようなことができます</p> <ul><li>CI config(.circleci/config.yml)のデバッグとvalidation</li> <li>ローカルでのジョブ実行</li> <li>CircleCIのAPI利用</li> <li>CircleCI Orbs関連</li></ul></li> <li><p>インストールするコマンドだけ残しておきます</p></li> <li><p>MacとLinuxでは次のコマンドでインストールできるようです</p></li> <li><p>念の為アップデートまで含めたコマンドを書いておきます</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># install</span>
$ <span class="token function">curl</span> -fLSs https://circle.ci/cli <span class="token operator">|</span> <span class="token function">bash</span> 
<span class="token comment"># update</span>
$ circleci update
$ circleci switch
</code></pre></div><ul><li>インストールしている際に, <code>permission denied</code>が発生することがあるようです</li> <li>その時はつぎのようにコマンドを変更して対処してください</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code></code></pre></div><h2 id="circleci-config-ymlファイルの作成"><a href="#circleci-config-ymlファイルの作成" aria-hidden="true" class="header-anchor">#</a> .circleci/config.ymlファイルの作成</h2> <ul><li>CircleCIの動作を定義するymlファイルを作成します</li> <li>記法についてはつぎの記事の通りに書けば問題ないはずです
<ul><li><a href="https://circleci.com/docs/2.0/configuration-reference/" target="_blank" rel="noopener noreferrer">Configuring CircleCI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <p>::: danger 注意</p> <ul><li><p><strong>インデントでerrorになることが多いです</strong></p></li> <li><p>注意しましょう</p> <ul><li>これで小一時間溶かしました
:::</li></ul></li> <li><p>雛形は, 先ほどの記事の下の方にあります</p> <ul><li><a href="https://circleci.com/docs/2.0/configuration-reference/#full-example" target="_blank" rel="noopener noreferrer">Full Example<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h2 id="作成したファイルのvalidation"><a href="#作成したファイルのvalidation" aria-hidden="true" class="header-anchor">#</a> 作成したファイルのvalidation</h2> <ul><li><p>つぎの公式記事の通りに進めれば問題ないはずです</p> <ul><li><a href="https://circleci.com/docs/2.0/local-cli/#validate-a-circleci-config" target="_blank" rel="noopener noreferrer">Validate A CircleCI Config<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><p>次のコマンドでvalidationができます</p> <ul><li>ただし, config.ymlは<code>.circleci/config.yml</code>に配置しましょう</li></ul></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ circleci config validate
<span class="token comment"># Config file at .circleci/config.yml is valid</span>
</code></pre></div><h1 id="本題"><a href="#本題" aria-hidden="true" class="header-anchor">#</a> 本題</h1> <ul><li><p>タイトルで触れている自動ビルド + デプロイの部分に入っていきます</p></li> <li><p>全体の流れはつぎのとおりです</p></li> <li><p>四角で囲まれた部分をCircleCIを用いて構築していきます</p></li> <li><p>CircleCIにやってもらいたいことは, つぎの2つです</p> <ul><li><code>$ yarn src:build</code>の実行</li> <li>実行後にできた<code>./docs</code>以下のファイルを<code>gh-pages</code>ブランチに配置</li></ul></li> <li><p>しかし, いずれもnodeのパッケージをインストールしておく必要があります</p></li> <li><p>その処理を書いてから, 先ほどの2つの処理を加えていきます</p></li></ul> <h2 id="_0-nodeのパッケージインストール"><a href="#_0-nodeのパッケージインストール" aria-hidden="true" class="header-anchor">#</a> 0. nodeのパッケージインストール</h2> <ul><li>nodeのパッケージをインストールするためには, つぎのように書きます</li> <li><code>restore_cache</code>と<code>save_cache</code>でnode_moduleのキャッシュを残しておくものです</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code>// .circleci/config.yml
+ version<span class="token punctuation">:</span> <span class="token number">2</span>
+ jobs<span class="token punctuation">:</span>
+   build<span class="token punctuation">:</span>
+     docker<span class="token punctuation">:</span>
+       <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">8.12</span>
+     working_directory<span class="token punctuation">:</span> ~/task4233/note
+     steps<span class="token punctuation">:</span>
+       <span class="token punctuation">-</span> checkout
+       <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span>
+           key<span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
+       <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
+           name<span class="token punctuation">:</span> Install dependencies
+           command<span class="token punctuation">:</span> yarn
+       <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>
+           key<span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
+           paths<span class="token punctuation">:</span>
+             <span class="token punctuation">-</span> ./node_modules
+
+ workflows<span class="token punctuation">:</span>
+   version<span class="token punctuation">:</span> <span class="token number">2</span>
+   build<span class="token punctuation">-</span><span class="token key atrule">deploy</span><span class="token punctuation">:</span>
+     jobs<span class="token punctuation">:</span>
+       <span class="token punctuation">-</span> build
</code></pre></div><h2 id="_1-yarn-src-buildの実行"><a href="#_1-yarn-src-buildの実行" aria-hidden="true" class="header-anchor">#</a> 1. <code>$ yarn src:build</code>の実行</h2> <ul><li>これは簡単です</li> <li>つぎのように, <code>.circleci/config.yml</code>に追記します</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code>// .circleci/config.yml
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">8.12</span>
    <span class="token key atrule">working_directory</span><span class="token punctuation">:</span> ~/task4233/note
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> checkout
      <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
          <span class="token key atrule">command</span><span class="token punctuation">:</span> yarn
      <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">paths</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ./node_modules
 +     <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
 +         name<span class="token punctuation">:</span> Build
 +         command<span class="token punctuation">:</span> yarn src<span class="token punctuation">:</span>build

<span class="token key atrule">workflows</span><span class="token punctuation">:</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">build-deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">jobs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> build
</code></pre></div><h2 id="_2-gh-pagesブランチに配置"><a href="#_2-gh-pagesブランチに配置" aria-hidden="true" class="header-anchor">#</a> 2. <code>gh-pages</code>ブランチに配置</h2> <ul><li>そのようなスクリプトは存在していないので, スクリプトを作成して<code>.circleci/config.yml</code>に追記します</li></ul> <h3 id="スクリプトの作成"><a href="#スクリプトの作成" aria-hidden="true" class="header-anchor">#</a> スクリプトの作成</h3> <ul><li><code>gh-pages</code>ブランチに<code>./docs</code>以下のファイルを配置するために, nodejsの<code>gh-pages</code>パッケージを利用します</li> <li>つぎのように新たに<code>deploy.js</code>を書きます</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// deploy.js</span>
<span class="token operator">+</span> <span class="token keyword">var</span> ghpages <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gh-pages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span> ghpages<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;./docs&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>     user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         name<span class="token punctuation">:</span> <span class="token string">&quot;{YOUR_NAME}&quot;</span><span class="token punctuation">,</span>
<span class="token operator">+</span>         email<span class="token punctuation">:</span> <span class="token string">&quot;{YOUR_EMAIL}&quot;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">+</span>     message<span class="token punctuation">:</span> <span class="token string">&quot;Auto build and deploy [ci skip]&quot;</span>
<span class="token operator">+</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>         process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Successfully Delployed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span>
<span class="token operator">+</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>6,7行目は自身のものに変更してください</li> <li>9行目でわざわざmessageを記載しているのは, コミットメッセージに<code>[ci skip]</code>を付与することで<code>gh-pages</code>ブランチでCircleCIを動作させないためです
<ul><li><code>gh-pages</code>ブランチは公開用ブランチなので, <code>gh-pages</code>ブランチではCircleCIを動作させません</li></ul></li></ul> <h3 id="スクリプトを実行するコマンドの追記"><a href="#スクリプトを実行するコマンドの追記" aria-hidden="true" class="header-anchor">#</a> スクリプトを実行するコマンドの追記</h3> <ul><li>このjsファイルを実行させるためのコマンドを<code>package.json</code>に追記します</li> <li>他の部分は私の設定なので, 自身の<code>package.json</code>に7行目の内容のみ追記してください</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;pg&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;main&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>       <span class="token string">&quot;deploy&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;node ./deploy.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;src:dev&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;vuepress dev src --port 3030&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;src:build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;rm -rf ./docs &amp;&amp; vuepress build src&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;repository&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;git&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;url&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;git+https://github.com/task4233/note.git&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;author&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;task4233&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;license&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;devDependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;markdown-it&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^8.4.2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;markdown-it-katex&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.0.3&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;markdown-it-task-lists&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.1.1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;vuepress&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^0.14.8&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gh-pages&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.0.1&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="circleci-config-ymlへの追記"><a href="#circleci-config-ymlへの追記" aria-hidden="true" class="header-anchor">#</a> .circleci/config.ymlへの追記</h3> <ul><li>コマンドが完成したので, <code>.circleci/config.yml</code>に追記します</li> <li>つぎのように追記します</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> node<span class="token punctuation">:</span><span class="token number">8.12</span>
    <span class="token key atrule">working_directory</span><span class="token punctuation">:</span> ~/task4233/note
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> checkout
      <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
          <span class="token key atrule">command</span><span class="token punctuation">:</span> yarn
      <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> yarn<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> .Branch <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;yarn.lock&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">paths</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ./node_modules
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Build
          <span class="token key atrule">command</span><span class="token punctuation">:</span> yarn src<span class="token punctuation">:</span>build
 +    <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
 +        name<span class="token punctuation">:</span> Deploy
 +        command<span class="token punctuation">:</span> yarn deploy

<span class="token key atrule">workflows</span><span class="token punctuation">:</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">build-deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">jobs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> build
</code></pre></div><h3 id="書いた-circleci-config-ymlのvalidate"><a href="#書いた-circleci-config-ymlのvalidate" aria-hidden="true" class="header-anchor">#</a> 書いた.circleci/config.ymlのvalidate</h3> <ul><li>githubにpushしてから<code>config.yml</code>のせいでエラーがでると悲しくなるので, ローカルでvalidateします</li> <li>つぎのコマンドでvalidateできます</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ circleci config validate -c <span class="token punctuation">{</span>config.ymlまでのファイルパス<span class="token punctuation">}</span>
<span class="token comment"># circleci config validate -c ./.circleci/config.yml</span>
<span class="token comment"># Config file at ./.circleci/config.yml is valid.</span>
</code></pre></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e447834c.js" defer></script><script src="/assets/js/4.ea1d030e.js" defer></script><script src="/assets/js/18.c76a41c9.js" defer></script>
  </body>
</html>
