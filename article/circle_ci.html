<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CircleCIを用いたVuePressの自動ビルド+デプロイ | Note</title>
    <meta name="description" content="VuePressの自動ビルド+デプロイ">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    
    <link rel="preload" href="/note/assets/css/0.styles.2662d710.css" as="style"><link rel="preload" href="/note/assets/js/app.b3f2337c.js" as="script"><link rel="preload" href="/note/assets/js/14.1232e6ff.js" as="script"><link rel="prefetch" href="/note/assets/js/10.b6ba17eb.js"><link rel="prefetch" href="/note/assets/js/11.c1aabc69.js"><link rel="prefetch" href="/note/assets/js/12.3627308a.js"><link rel="prefetch" href="/note/assets/js/13.cbf35d95.js"><link rel="prefetch" href="/note/assets/js/15.bb82d668.js"><link rel="prefetch" href="/note/assets/js/16.f44ef588.js"><link rel="prefetch" href="/note/assets/js/17.cad43b58.js"><link rel="prefetch" href="/note/assets/js/18.bcc13472.js"><link rel="prefetch" href="/note/assets/js/19.575631a0.js"><link rel="prefetch" href="/note/assets/js/2.6f351ac2.js"><link rel="prefetch" href="/note/assets/js/20.da84c63b.js"><link rel="prefetch" href="/note/assets/js/21.34d9b943.js"><link rel="prefetch" href="/note/assets/js/22.bda312d8.js"><link rel="prefetch" href="/note/assets/js/23.62e971f2.js"><link rel="prefetch" href="/note/assets/js/24.7ff556cc.js"><link rel="prefetch" href="/note/assets/js/25.fa4f2487.js"><link rel="prefetch" href="/note/assets/js/26.c60738b4.js"><link rel="prefetch" href="/note/assets/js/27.d92d2d49.js"><link rel="prefetch" href="/note/assets/js/28.e37f6450.js"><link rel="prefetch" href="/note/assets/js/29.9839bab9.js"><link rel="prefetch" href="/note/assets/js/3.513760e1.js"><link rel="prefetch" href="/note/assets/js/30.2b92fc3e.js"><link rel="prefetch" href="/note/assets/js/31.6bc71a6a.js"><link rel="prefetch" href="/note/assets/js/32.d1ba751c.js"><link rel="prefetch" href="/note/assets/js/33.3600486b.js"><link rel="prefetch" href="/note/assets/js/34.aa291525.js"><link rel="prefetch" href="/note/assets/js/35.831f5cda.js"><link rel="prefetch" href="/note/assets/js/36.560470af.js"><link rel="prefetch" href="/note/assets/js/37.bc3f988c.js"><link rel="prefetch" href="/note/assets/js/38.cd0f67c3.js"><link rel="prefetch" href="/note/assets/js/39.31e72246.js"><link rel="prefetch" href="/note/assets/js/4.e14397b8.js"><link rel="prefetch" href="/note/assets/js/40.aa8d3038.js"><link rel="prefetch" href="/note/assets/js/41.51f55703.js"><link rel="prefetch" href="/note/assets/js/42.b813e977.js"><link rel="prefetch" href="/note/assets/js/43.0c82b4ee.js"><link rel="prefetch" href="/note/assets/js/44.848347bc.js"><link rel="prefetch" href="/note/assets/js/45.d748265f.js"><link rel="prefetch" href="/note/assets/js/46.eb19372e.js"><link rel="prefetch" href="/note/assets/js/47.e2e9d794.js"><link rel="prefetch" href="/note/assets/js/48.1b67e1b0.js"><link rel="prefetch" href="/note/assets/js/49.caae70a4.js"><link rel="prefetch" href="/note/assets/js/5.4459fffc.js"><link rel="prefetch" href="/note/assets/js/6.f359b694.js"><link rel="prefetch" href="/note/assets/js/7.90c1793a.js"><link rel="prefetch" href="/note/assets/js/8.f8ae5d2e.js"><link rel="prefetch" href="/note/assets/js/9.8138651f.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.2662d710.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">Note</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/about.html" class="nav-link">About</a></div><div class="nav-item"><a href="/note/list.html" class="nav-link">Articles</a></div><div class="nav-item"><a href="/note/chukapi_fun_art.html" class="nav-link">Chukapi-Fun-Art</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/about.html" class="nav-link">About</a></div><div class="nav-item"><a href="/note/list.html" class="nav-link">Articles</a></div><div class="nav-item"><a href="/note/chukapi_fun_art.html" class="nav-link">Chukapi-Fun-Art</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>CircleCIを用いたVuePressの自動ビルド+デプロイ</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/note/article/circle_ci.html#初期設定" class="sidebar-link">初期設定</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#_1-登録" class="sidebar-link">1. 登録</a></li><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#_2-ssh-keyの設定" class="sidebar-link">2.ssh-keyの設定</a></li><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#_3-circleci-cliツールのインストール" class="sidebar-link">3.CircleCI CLIツールのインストール</a></li></ul></li><li><a href="/note/article/circle_ci.html#circleci-config-ymlファイルの作成" class="sidebar-link">.circleci/config.ymlファイルの作成</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/article/circle_ci.html#作成したファイルのvalidation" class="sidebar-link">作成したファイルのvalidation</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/article/circle_ci.html#_0-nodeのパッケージインストール" class="sidebar-link">0. nodeのパッケージインストール</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/article/circle_ci.html#_1-yarn-src-buildの実行" class="sidebar-link">1. $ yarn src:buildの実行</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/note/article/circle_ci.html#_2-gh-pagesブランチに配置" class="sidebar-link">2. gh-pagesブランチに配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#スクリプトの作成" class="sidebar-link">スクリプトの作成</a></li><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#スクリプトを実行するコマンドの追記" class="sidebar-link">スクリプトを実行するコマンドの追記</a></li><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#circleci-config-ymlへの追記" class="sidebar-link">.circleci/config.ymlへの追記</a></li><li class="sidebar-sub-header"><a href="/note/article/circle_ci.html#書いた-circleci-config-ymlのvalidate" class="sidebar-link">書いた.circleci/config.ymlのvalidate</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="circleciを用いたvuepressの自動ビルド-デプロイ"><a href="#circleciを用いたvuepressの自動ビルド-デプロイ" aria-hidden="true" class="header-anchor">#</a> CircleCIを用いたVuePressの自動ビルド+デプロイ</h1> <ul><li>タイトルのとおりです</li></ul> <h1 id="はじめに"><a href="#はじめに" aria-hidden="true" class="header-anchor">#</a> はじめに</h1> <ul><li><p>VuePressは毎回buildする必要があるので面倒</p></li> <li><p>誰かがCIを使って自動デプロイとか言ってたな</p></li> <li><p>やってみるか</p></li> <li><p>や　り　ま　し　た</p></li></ul> <h1 id="circleciのセッティング"><a href="#circleciのセッティング" aria-hidden="true" class="header-anchor">#</a> CircleCIのセッティング</h1> <ul><li>インストール等のセッティングを行います</li> <li>本題を見たい方は, 本題まで飛んでください</li></ul> <h2 id="初期設定"><a href="#初期設定" aria-hidden="true" class="header-anchor">#</a> 初期設定</h2> <ul><li>大抵はつぎの公式ページに書かれています</li> <li>公式がちゃんとしているので書くことはあまりないですが, 流れだけざっとさらっていきます</li> <li>部分的に翻訳されているようです
<ul><li><a href="https://circleci.com/docs/ja/2.0/" target="_blank" rel="noopener noreferrer">Welcome to CircleCI Documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h3 id="_1-登録"><a href="#_1-登録" aria-hidden="true" class="header-anchor">#</a> 1. 登録</h3> <ul><li>つぎの公式記事の通りに進めれば問題ないはずです
<ul><li><a href="https://circleci.com/docs/ja/2.0/first-steps/#section=getting-started" target="_blank" rel="noopener noreferrer">CircleCIを始める<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h3 id="_2-ssh-keyの設定"><a href="#_2-ssh-keyの設定" aria-hidden="true" class="header-anchor">#</a> 2.ssh-keyの設定</h3> <ul><li>つぎの記事の通りに進めれば問題ないはずです
<ul><li><a href="https://qiita.com/boushi-bird@github/items/6b6eb1d1ed6f6d3341e4" target="_blank" rel="noopener noreferrer">Circle CI で Github に write access 可能な Deploy key を設定する<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://circleci.com/docs/ja/2.0/add-ssh-key/" target="_blank" rel="noopener noreferrer">CircleCI に SSH 鍵を登録する<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <div class="danger custom-block"><p class="custom-block-title">注意</p> <ul><li><strong>パスフレーズ付きのrsa鍵だとCircleCI側から認められないので注意してください</strong> <ul><li>これに騙されました</li></ul></li></ul></div> <h3 id="_3-circleci-cliツールのインストール"><a href="#_3-circleci-cliツールのインストール" aria-hidden="true" class="header-anchor">#</a> 3.CircleCI CLIツールのインストール</h3> <ul><li><p>つぎの公式記事の通りに進めれば問題ないはずです</p> <ul><li><a href="https://circleci.com/docs/ja/2.0/local-cli/#installation" target="_blank" rel="noopener noreferrer">Installation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><p>CircleCI CLIツールでは, つぎのようなことができます</p> <ul><li>CI config(.circleci/config.yml)のデバッグとvalidation</li> <li>ローカルでのジョブ実行</li> <li>CircleCIのAPI利用</li> <li>CircleCI Orbs関連</li></ul></li> <li><p>インストールするコマンドだけ残しておきます</p></li> <li><p>MacとLinuxでは次のコマンドでインストールできるようです</p></li> <li><p>念の為アップデートまで含めたコマンドを書いておきます</p></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># install</span>
$ <span class="token function">curl</span> -fLSs https://circle.ci/cli <span class="token operator">|</span> <span class="token function">bash</span> 
<span class="token comment"># update</span>
$ circleci update
$ circleci switch
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>インストールしている際に, <code>permission denied</code>が発生することがあるようです</li> <li>その時はつぎのようにコマンドを変更して対処してください</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code></code></pre> <div class="line-numbers-wrapper"></div></div><h2 id="circleci-config-ymlファイルの作成"><a href="#circleci-config-ymlファイルの作成" aria-hidden="true" class="header-anchor">#</a> .circleci/config.ymlファイルの作成</h2> <ul><li>CircleCIの動作を定義するymlファイルを作成します</li> <li>記法についてはつぎの記事の通りに書けば問題ないはずです
<ul><li><a href="https://circleci.com/docs/2.0/configuration-reference/" target="_blank" rel="noopener noreferrer">Configuring CircleCI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <div class="danger custom-block"><p class="custom-block-title">注意</p> <ul><li><strong>インデントでerrorになることが多いです</strong></li> <li>注意しましょう
<ul><li>これで小一時間溶かしました</li></ul></li></ul></div> <ul><li>雛形は, 先ほどの記事の下の方にあります
<ul><li><a href="https://circleci.com/docs/2.0/configuration-reference/#full-example" target="_blank" rel="noopener noreferrer">Full Example<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul> <h2 id="作成したファイルのvalidation"><a href="#作成したファイルのvalidation" aria-hidden="true" class="header-anchor">#</a> 作成したファイルのvalidation</h2> <ul><li><p>つぎの公式記事の通りに進めれば問題ないはずです</p> <ul><li><a href="https://circleci.com/docs/2.0/local-cli/#validate-a-circleci-config" target="_blank" rel="noopener noreferrer">Validate A CircleCI Config<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><p>次のコマンドでvalidationができます</p> <ul><li>ただし, config.ymlは<code>.circleci/config.yml</code>に配置しましょう</li></ul></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ circleci config validate
<span class="token comment"># Config file at .circleci/config.yml is valid</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h1 id="本題"><a href="#本題" aria-hidden="true" class="header-anchor">#</a> 本題</h1> <ul><li><p>タイトルで触れている自動ビルド + デプロイの部分に入っていきます</p></li> <li><p>全体の流れはつぎのとおりです</p></li> <li><p>四角で囲まれた部分をCircleCIを用いて構築していきます</p></li> <li><p>CircleCIにやってもらいたいことは, つぎの2つです</p> <ul><li><code>$ yarn src:build</code>の実行</li> <li>実行後にできた<code>./docs</code>以下のファイルを<code>gh-pages</code>ブランチに配置</li></ul></li> <li><p>しかし, いずれもnodeのパッケージをインストールしておく必要があります</p></li> <li><p>その処理を書いてから, 先ほどの2つの処理を加えていきます</p></li></ul> <h2 id="_0-nodeのパッケージインストール"><a href="#_0-nodeのパッケージインストール" aria-hidden="true" class="header-anchor">#</a> 0. nodeのパッケージインストール</h2> <ul><li>nodeのパッケージをインストールするためには, つぎのように書きます</li> <li><code>restore_cache</code>と<code>save_cache</code>でnode_moduleのキャッシュを残しておくものです</li></ul> <div class="language-yml line-numbers-mode"><pre class="language-text"><code>// .circleci/config.yml
+ version: 2
+ jobs:
+   build:
+     docker:
+       - image: node:8.12
+     working_directory: ~/task4233/note
+     steps:
+       - checkout
+       - restore_cache:
+           key: yarn-{{ .Branch }}-{{ checksum &quot;yarn.lock&quot; }}
+       - run:
+           name: Install dependencies
+           command: yarn
+       - save_cache:
+           key: yarn-{{ .Branch }}-{{ checksum &quot;yarn.lock&quot; }}
+           paths:
+             - ./node_modules
+
+ workflows:
+   version: 2
+   build-deploy:
+     jobs:
+       - build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="_1-yarn-src-buildの実行"><a href="#_1-yarn-src-buildの実行" aria-hidden="true" class="header-anchor">#</a> 1. <code>$ yarn src:build</code>の実行</h2> <ul><li>これは簡単です</li> <li>つぎのように, <code>.circleci/config.yml</code>に追記します</li></ul> <div class="language-yml line-numbers-mode"><pre class="language-text"><code>// .circleci/config.yml
version: 2
jobs:
  build:
    docker:
      - image: node:8.12
    working_directory: ~/task4233/note
    steps:
      - checkout
      - restore_cache:
          key: yarn-{{ .Branch }}-{{ checksum &quot;yarn.lock&quot; }}
      - run:
          name: Install dependencies
          command: yarn
      - save_cache:
          key: yarn-{{ .Branch }}-{{ checksum &quot;yarn.lock&quot; }}
          paths:
            - ./node_modules
 +     - run:
 +         name: Build
 +         command: yarn src:build

workflows:
  version: 2
  build-deploy:
    jobs:
      - build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="_2-gh-pagesブランチに配置"><a href="#_2-gh-pagesブランチに配置" aria-hidden="true" class="header-anchor">#</a> 2. <code>gh-pages</code>ブランチに配置</h2> <ul><li>そのようなスクリプトは存在していないので, スクリプトを作成して<code>.circleci/config.yml</code>に追記します</li></ul> <h3 id="スクリプトの作成"><a href="#スクリプトの作成" aria-hidden="true" class="header-anchor">#</a> スクリプトの作成</h3> <ul><li><code>gh-pages</code>ブランチに<code>./docs</code>以下のファイルを配置するために, nodejsの<code>gh-pages</code>パッケージを利用します</li> <li>つぎのように新たに<code>deploy.js</code>を書きます</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// deploy.js</span>
<span class="token operator">+</span> <span class="token keyword">var</span> ghpages <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gh-pages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span> ghpages<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">&quot;./docs&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>     user<span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         name<span class="token punctuation">:</span> <span class="token string">&quot;{YOUR_NAME}&quot;</span><span class="token punctuation">,</span>
<span class="token operator">+</span>         email<span class="token punctuation">:</span> <span class="token string">&quot;{YOUR_EMAIL}&quot;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">+</span>     message<span class="token punctuation">:</span> <span class="token string">&quot;Auto build and deploy [ci skip]&quot;</span>
<span class="token operator">+</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>         process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Successfully Delployed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>     <span class="token punctuation">}</span>
<span class="token operator">+</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>6,7行目は自身のものに変更してください</li> <li>9行目でわざわざmessageを記載しているのは, コミットメッセージに<code>[ci skip]</code>を付与することで<code>gh-pages</code>ブランチでCircleCIを動作させないためです
<ul><li><code>gh-pages</code>ブランチは公開用ブランチなので, <code>gh-pages</code>ブランチではCircleCIを動作させません</li></ul></li></ul> <h3 id="スクリプトを実行するコマンドの追記"><a href="#スクリプトを実行するコマンドの追記" aria-hidden="true" class="header-anchor">#</a> スクリプトを実行するコマンドの追記</h3> <ul><li>このjsファイルを実行させるためのコマンドを<code>package.json</code>に追記します</li> <li>他の部分は私の設定なので, 自身の<code>package.json</code>に7行目の内容のみ追記してください</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;pg&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;version&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;main&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="token operator">+</span>       <span class="token string">&quot;deploy&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;node ./deploy.js&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;src:dev&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;vuepress dev src --port 3030&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;src:build&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;rm -rf ./docs &amp;&amp; vuepress build src&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;repository&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;git&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;url&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;git+https://github.com/task4233/note.git&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;author&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;task4233&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;license&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;devDependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;markdown-it&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^8.4.2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;markdown-it-katex&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.0.3&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;markdown-it-task-lists&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.1.1&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;vuepress&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^0.14.8&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dependencies&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;gh-pages&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;^2.0.1&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="circleci-config-ymlへの追記"><a href="#circleci-config-ymlへの追記" aria-hidden="true" class="header-anchor">#</a> .circleci/config.ymlへの追記</h3> <ul><li>コマンドが完成したので, <code>.circleci/config.yml</code>に追記します</li> <li>つぎのように追記します</li></ul> <div class="language-yml line-numbers-mode"><pre class="language-text"><code>version: 2
jobs:
  build:
    docker:
      - image: node:8.12
    working_directory: ~/task4233/note
    steps:
      - checkout
      - restore_cache:
          key: yarn-{{ .Branch }}-{{ checksum &quot;yarn.lock&quot; }}
      - run:
          name: Install dependencies
          command: yarn
      - save_cache:
          key: yarn-{{ .Branch }}-{{ checksum &quot;yarn.lock&quot; }}
          paths:
            - ./node_modules
      - run:
          name: Build
          command: yarn src:build
 +    - run:
 +        name: Deploy
 +        command: yarn deploy

workflows:
  version: 2
  build-deploy:
    jobs:
      - build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="書いた-circleci-config-ymlのvalidate"><a href="#書いた-circleci-config-ymlのvalidate" aria-hidden="true" class="header-anchor">#</a> 書いた.circleci/config.ymlのvalidate</h3> <ul><li>githubにpushしてから<code>config.yml</code>のせいでエラーがでると悲しくなるので, ローカルでvalidateします</li> <li>つぎのコマンドでvalidateできます</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ circleci config validate -c <span class="token punctuation">{</span>config.ymlまでのファイルパス<span class="token punctuation">}</span>
<span class="token comment"># circleci config validate -c ./.circleci/config.yml</span>
<span class="token comment"># Config file at ./.circleci/config.yml is valid.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2019-3-23 11:13:12</span></div></div> <!----> </div> <!----></div></div>
    <script src="/note/assets/js/app.b3f2337c.js" defer></script><script src="/note/assets/js/14.1232e6ff.js" defer></script>
  </body>
</html>
